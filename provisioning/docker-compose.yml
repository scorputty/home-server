# This file will be called from Ansible

version: '2'

services:
  vault:
    container_name: vault
    hostname: vault
    image: docker.io/vault
    ports:
      - "8200:8200"
    volumes:
      - /shared/log/vault
      - /shared/data/vault
      - /shared/config/vault

  consul1:
    container_name: consul1
    image: docker.io/consul
    hostname: consul1
    ports:
      - "8301:8300"
      - "8401:8400"
      - "8501:8500"
      - "8601:8600"
      - "9001:9001"
    environment:
      - CONSUL_OPTS=-bootstrap-expect=3
    volumes:
      - /shared/log/consul1
      - /shared/data/consul1
      - /shared/config/consul1

  consul2:
    container_name: consul2
    image: docker.io/consul
    hostname: consul2
    links:
      - consul1
    ports:
      - "8302:8300"
      - "8402:8400"
      - "8502:8500"
      - "8602:8600"
      - "9002:9001"
    environment:
      - CONSUL_OPTS=-rejoin -retry-join=consul1
    volumes:
      - /shared/log/consul2
      - /shared/data/consul2
      - /shared/config/consul2

  consul3:
    container_name: consul3
    image: docker.io/consul
    links:
      - consul1
    ports:
      - "8303:8300"
      - "8403:8400"
      - "8503:8500"
      - "8603:8600"
      - "9003:9001"
    environment:
      - CONSUL_OPTS=-rejoin -retry-join=consul1
    volumes:
      - /shared/log/consul3
      - /shared/data/consul3
      - /shared/config/consul3

  couchpotato:
    container_name: couchpotato
    image: docker.io/cryptout/couchpotato
    ports:
      - "5050:5050"
    links:
      - sabnzbd
      - deluge
    environment:
      - ENV appUser="media"
      - ENV appGroup="1000"
    volumes:
      - /shared/config/couchpotato:/config
      - /shared/data:/data

  sabnzbd:
    container_name: sabnzbd
    image: docker.io/cryptout/sabnzbd
    ports:
      - "8080:8080"
      - "9090:9090"
    expose:
      - "8080"
      - "9090"
    environment:
      - ENV appUser="media"
      - ENV appGroup="1000"
    volumes:
      - /shared/config/sabnzbd:/config
      - /shared/data/sabnzbd/downloads:/downloads
      - /shared/data/sabnzbd/incomplete-downloads:/incomplete-downloads

  deluge:
    container_name: deluge
    image: docker.io/cryptout/deluge
    ports:
      - "8112:8112"
      - "58846:58846"
      - "58946/udp:58946/udp"
    expose:
      - "8112"
      - "58846"
      - "58496/udp"
    environment:
      - TZ="Europe/Amsterdam"
      - PUID="1000"
      - PGID="1000"
      - ENV appUser="media"
      - ENV appGroup="1000"
    volumes:
      - /shared/config/deluge:/config
      - /shared/data/deluge/downloads:/downloads
